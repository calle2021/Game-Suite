find_program(GLSLC NAMES glslc HINTS Vulkan::glslc)

set(SHADER_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}")
set(SHADER_BUILD_DIR "${CMAKE_BINARY_DIR}/assets/shaders")
file(MAKE_DIRECTORY ${SHADER_BUILD_DIR})

set(COMPILED_SHADERS)

set(VERTEX_SHADER_NAME "shader.vert")
set(VERTEX_SHADER_INPUT "${SHADER_SRC_DIR}/${VERTEX_SHADER_NAME}")
set(VERTEX_SHADER_OUTPUT "${SHADER_BUILD_DIR}/vert.spv")
add_custom_command(
    OUTPUT ${VERTEX_SHADER_OUTPUT}
    COMMAND GLSLC ${VERTEX_SHADER_INPUT} -o ${VERTEX_SHADER_OUTPUT}
    DEPENDS ${VERTEX_SHADER_NAME}
    COMMENT "Compiling shader: ${VERTEX_SHADER_NAME}"
    VERBATIM
)
list(APPEND COMPILED_SHADERS ${VERTEX_SHADER_OUTPUT})

set(FRAGMENT_SHADER_NAME "shader.frag")
set(FRAGMENT_SHADER_INPUT "${SHADER_SRC_DIR}/${FRAGMENT_SHADER_NAME}")
set(FRAGMENT_SHADER_OUTPUT "${SHADER_BUILD_DIR}/frag.spv")
add_custom_command(
    OUTPUT ${FRAGMENT_SHADER_OUTPUT}
    COMMAND GLSLC ${FRAGMENT_SHADER_INPUT} -o ${FRAGMENT_SHADER_OUTPUT}
    DEPENDS ${FRAGMENT_SHADER_NAME}
    COMMENT "Compiling shader: ${FRAGMENT_SHADER_NAME}"
    VERBATIM
)
list(APPEND COMPILED_SHADERS ${FRAGMENT_SHADER_OUTPUT})

add_custom_target(shaders ALL DEPENDS ${COMPILED_SHADERS})